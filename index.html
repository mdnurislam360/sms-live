<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HE Live Streaming</title>

<style>
/* =========================
   Base Layout
========================= */
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#0f172a;
    font-family:sans-serif;
}

#root{
    width:100vw;
    height:100vh;
    position:relative;
}

/* =========================
   üëÅ Small Eye Viewer Counter (¬º size)
========================= */
#coin-system{
    position:absolute;
    top:12px;
    right:12px;
    display:flex;
    align-items:center;
    gap:6px;
    padding:4px 8px;
    background:rgba(0,0,0,.55);
    border-radius:20px;
    color:#fff;
    font-size:12px;
    z-index:9999;
}

/* Eye shape */
.eye-container{
    width:20px;
    height:12px;
    background:#fff;
    border:2px solid #FFAB40;
    border-radius:100% 0%;
    transform:rotate(45deg);
    position:relative;
    overflow:hidden;
}

/* iris */
.iris{
    width:10px;
    height:10px;
    background:#29B6F6;
    border-radius:50%;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) rotate(-45deg);
}

/* pupil */
.pupil{
    width:5px;
    height:5px;
    background:#0d1117;
    border-radius:50%;
    margin:auto;
    position:relative;
    top:2px;
}

#coin-count{
    font-weight:bold;
}

/* ========================= */
</style>
</head>

<body>

<!-- Zego container -->
<div id="root"></div>

<!-- üëÅ Viewer Counter -->
<div id="coin-system">
    <div class="eye-container">
        <div class="iris">
            <div class="pupil"></div>
        </div>
    </div>
    <span id="coin-count">0</span>
</div>


<!-- Zego SDK -->
<script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>

<script>
/* =========================
   Zego Setup
========================= */

function getUrlParams(url){
    let urlStr = url.split('?')[1] || '';
    const urlSearchParams = new URLSearchParams(urlStr);
    return Object.fromEntries(urlSearchParams.entries());
}

const roomID = getUrlParams(window.location.href)['roomID'] || "room1";
const userID = "user_" + Math.floor(Math.random()*10000);
const userName = "User" + userID;

const appID = 480055648;
const serverSecret = "a341f27a11c9af1547c670c09b6df111";

const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(
    appID,
    serverSecret,
    roomID,
    userID,
    userName
);

let roleParam = getUrlParams(window.location.href)['role'] || 'Host';
const role = roleParam === 'Host'
    ? ZegoUIKitPrebuilt.Host
    : ZegoUIKitPrebuilt.Audience;

const zp = ZegoUIKitPrebuilt.create(kitToken);


/* =========================
   Join Room
========================= */
zp.joinRoom({
    container: document.querySelector("#root"),

    showPreJoinView:false,

    scenario:{
        mode: ZegoUIKitPrebuilt.LiveStreaming,
        config:{ role }
    },

    sharedLinks:[{
        name:'Join as audience',
        url:
        window.location.protocol + '//' +
        window.location.host +
        window.location.pathname +
        '?roomID='+roomID+'&role=Audience'
    }],

    onLiveStart:()=>{
        startViewerSystem();
    },

    onUserJoin:(users)=>{
        viewers += users.length;
        updateViewer();
    },

    onUserLeave:(users)=>{
        viewers -= users.length;
        if(viewers < 0) viewers = 0;
        updateViewer();
    }
});


/* =========================
   üëÅ Viewer / Coin System
========================= */
let viewers = 0;

function updateViewer(){
    document.getElementById("coin-count").innerText = viewers;
}

function startViewerSystem(){
    // Demo auto increase
    setInterval(()=>{
        viewers += Math.floor(Math.random()*3)+1;
        updateViewer();
    },3000);
}

</script>

</body>
</html>
